<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VIP Entry | @vreasyhealthy</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; }
    .card { max-width: 560px; margin: 0 auto; padding: 24px; border: 1px solid #eee; border-radius: 16px; }
    .btn { display:inline-block; padding:12px 16px; border-radius:12px; border:1px solid #ccc; text-decoration:none; }
    .btn-primary { border-color:#2b8a3e; }
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<div class="card">
  <h2>VIP Registration</h2>
  <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Add Friend ‡∏Å‡∏±‡∏ö @vreasyhealthy ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
  <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‚Ä¶</div>
  <div id="actions" style="margin-top:16px;"></div>
</div>

<script>
  const LIFF_ID = "<YOUR_LIFF_ID>"; // ‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á
  const OA_ADD_FRIEND_URL = "https://line.me/R/ti/p/@vreasyhealthy";
  const LEGACY_REGISTER = "https://www.legacy.co.th/member/register?sp=167328";

  // URL ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö "‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à"
  // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ legacy ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Äú‡∏Å‡∏î‡∏Å‡∏•‡∏±‡∏ö‚Äù ‡πÄ‡∏≠‡∏á
  // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤ bridge ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô https://your-domain.com/vip-done ‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const RETURN_LIFF_DEEPLINK = `https://liff.line.me/${LIFF_ID}?step=done`;

  async function main() {
    await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
    if (!liff.isLoggedIn()) liff.login();

    const statusEl = document.getElementById('status');
    const actions = document.getElementById('actions');

    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£
    const url = new URL(window.location.href);
    if (url.searchParams.get('step') === 'done') {
      statusEl.innerText = "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏ó";
      try {
        if (liff.isInClient()) {
          // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏≤ OA (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
          // await liff.sendMessages([{ type: 'text', text: 'VIP: Registration completed.' }]);
          liff.closeWindow();
        } else {
          // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö OA ‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå
          window.location.href = "https://line.me/R/ti/p/@vreasyhealthy";
        }
      } catch (e) {
        console.error(e);
      }
      return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô OA ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    try {
      const friendship = await liff.getFriendship();
      if (!friendship.friendFlag) {
        statusEl.innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö @vreasyhealthy";
        actions.innerHTML = `
          <a class="btn btn-primary" href="${OA_ADD_FRIEND_URL}" target="_blank" rel="noopener">‚ûï Add Friend</a>
          <button class="btn" id="btnCheck">‡∏â‡∏±‡∏ô‡∏Å‡∏î Add ‡πÅ‡∏•‡πâ‡∏ß</button>
        `;
        document.getElementById('btnCheck').onclick = () => window.location.reload();
        return;
      }

      // ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
      statusEl.innerText = "‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‚Ä¶";
      // ‡πÅ‡∏ô‡∏ö state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î ‚Äú‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà LINE‚Äù ‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å
      const state = encodeURIComponent(RETURN_LIFF_DEEPLINK);
      const registerUrl = `${LEGACY_REGISTER}&return=${state}`;
      // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (in-app browser)
      liff.openWindow({ url: registerUrl, external: false });

    } catch (err) {
      console.error(err);
      statusEl.innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
    }
  }

  main();
</script>
</body>
</html>
