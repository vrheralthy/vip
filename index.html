<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VIP Entry | @vreasyhealthy</title>
  <meta name="theme-color" content="#16a34a" />
  <meta name="description" content="Add Friend @vreasyhealthy ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å Legacy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå VIP" />
  <style>
    :root{
      --bg:#0b0f14;        /* ‡∏î‡∏≤‡∏£‡πå‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏´‡∏£‡∏π‡πÜ */
      --card:#0f1720;
      --muted:#8aa0b4;
      --text:#e8f0f7;
      --primary:#16a34a;
      --primary-2:#22c55e;
      --ring:#1f2937;
      --border:#16212c;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 80% -10%, #17324a 0%, transparent 60%),
                  radial-gradient(900px 500px at -10% 110%, #123b28 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      line-height:1.55;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .wrap{width:100%; max-width:620px}
    .brand{
      display:flex; align-items:center; gap:12px; margin:0 0 16px;
      color:#d9f99d; letter-spacing:.2px; font-weight:700; text-transform:uppercase; font-size:12px;
    }
    .chip{border:1px solid #2a3a47; padding:4px 10px; border-radius:999px; background:#0f1a22}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0)) , var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px;
    }
    h1{margin:0 0 6px; font-size:28px; letter-spacing:.2px}
    p.lead{margin:0 0 16px; color:var(--muted)}
    #status{margin-top:6px; color:#cfe1ff}
    #debug{margin-top:10px; color:#93c5fd; font-size:12px; display:none}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:18px}
    .btn{
      appearance:none; border:1px solid #2b3846; background:#0e1821; color:#dbeafe;
      padding:12px 16px; border-radius:14px; cursor:pointer; font-weight:600;
      transition: .15s ease; text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{transform: translateY(-1px); border-color:#3a4a5a}
    .btn:active{transform: translateY(0)}
    .btn-primary{
      background:linear-gradient(180deg, var(--primary-2), var(--primary));
      color:#06240f; border-color:#2dd36f; box-shadow:0 6px 20px rgba(34,197,94,.35);
    }
    .btn-primary:hover{filter:brightness(1.03)}
    .btn-ghost{background:transparent}
    .divider{height:1px; background:#17222e; margin:18px 0}
    .muted{color:var(--muted); font-size:13px}
    .center{display:flex; align-items:center; gap:10px}
    .spinner{
      width:18px; height:18px; border-radius:50%;
      border:3px solid rgba(255,255,255,.15);
      border-top-color:#93c5fd; animation:spin 0.9s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .hide{display:none !important}
    .ok{color:#bbf7d0}
    .err{color:#fecaca}
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="brand"><span class="chip">VREASYHEALTHY</span> VIP FLOW</div>
    <div class="card" role="main">
      <h1>VIP Registration</h1>
      <p class="lead">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Add Friend ‡∏Å‡∏±‡∏ö <b>@vreasyhealthy</b> ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å Legacy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©</p>

      <div class="center muted">
        <div id="spin" class="spinner" aria-hidden="true"></div>
        <div id="status" aria-live="polite">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‚Ä¶</div>
      </div>

      <div class="row" id="actions" aria-label="actions"></div>
      <div class="divider"></div>
      <div class="muted">‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏û‡∏≤‡πÑ‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥? ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
      <div class="row">
        <button class="btn btn-primary" id="btnGoManual">‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        <a class="btn btn-ghost" id="btnBackToOA" href="https://line.me/R/ti/p/@vreasyhealthy">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö OA</a>
      </div>

      <div id="debug"></div>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  const LIFF_ID = "2007996778-ojPmjnww";
  const OA_ADD_FRIEND_URL = "https://line.me/R/ti/p/@vreasyhealthy";
  const LEGACY_REGISTER = "https://www.legacy.co.th/member/register?sp=167328";
  // optional return (‡∏´‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
  const RETURN_LIFF_DEEPLINK = `https://liff.line.me/${LIFF_ID}?step=done`;

  // ====== HELPERS ======
  const $ = (q)=>document.querySelector(q);
  const statusEl = $('#status');
  const actions  = $('#actions');
  const spin     = $('#spin');
  const debugEl  = $('#debug');
  const setStatus = (txt, cls)=>{ statusEl.textContent = txt; statusEl.className = cls||''; };
  const showDebug = (msg)=>{ debugEl.style.display='block'; debugEl.textContent = `DEBUG: ${msg}`; };

  function goRegister(){
    // ‡πÅ‡∏ô‡∏ö return ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    const url = `${LEGACY_REGISTER}&return=${encodeURIComponent(RETURN_LIFF_DEEPLINK)}`;
    try{
      if (liff.isInClient()) {
        liff.openWindow({ url, external:false });
      } else {
        // Fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ/‡∏ô‡∏≠‡∏Å LINE
        window.location.assign(url);
      }
    }catch(e){
      console.error(e);
      showDebug(e?.message || String(e));
      window.location.href = url; // last resort
    }
  }

  function showAddFriend(){
    setStatus("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö @vreasyhealthy", "err");
    spin.classList.add('hide');
    actions.innerHTML = `
      <a class="btn btn-primary" href="${OA_ADD_FRIEND_URL}" target="_blank" rel="noopener">‚ûï Add Friend</a>
      <button class="btn" id="btnCheck">‡∏â‡∏±‡∏ô‡∏Å‡∏î Add ‡πÅ‡∏•‡πâ‡∏ß</button>
    `;
    $('#btnCheck').onclick = ()=>window.location.reload();
  }

  function showGoRegisterUI(){
    setStatus("‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‚Ä¶", "ok");
    // ‡∏•‡∏≠‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    goRegister();
    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å pop/redirect ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
    setTimeout(()=>{
      spin.classList.add('hide');
      actions.innerHTML = `<button class="btn btn-primary" id="btnGo">‡πÑ‡∏õ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>`;
      $('#btnGo').onclick = goRegister;
    }, 1200);
  }

  async function handleReturn(){
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (‡∏´‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö)
    setStatus("‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏ó‚Ä¶","ok");
    try{
      if (liff.isInClient()) {
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö OA ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
        // await liff.sendMessages([{ type:'text', text:'VIP: Registration completed.' }]);
        liff.closeWindow();
      } else {
        window.location.href = OA_ADD_FRIEND_URL;
      }
    }catch(e){
      console.error(e);
      showDebug(e?.message || String(e));
      window.location.href = OA_ADD_FRIEND_URL;
    }
  }

  // ====== MAIN ======
  (async () => {
    try{
      await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
      if (!liff.isLoggedIn()) { liff.login(); return; }

      // ‡∏õ‡∏∏‡πà‡∏° manual ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
      $('#btnGoManual').onclick = goRegister;

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô flow ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      const url = new URL(window.location.href);
      if (url.searchParams.get('step') === 'done') {
        await handleReturn();
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô OA
      const friendship = await liff.getFriendship();
      if (!friendship?.friendFlag) {
        showAddFriend();
        return;
      }
      showGoRegisterUI();

    }catch(err){
      console.error(err);
      setStatus("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE", "err");
      spin.classList.add('hide');
      showDebug(err?.message || String(err));
      // ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° manual
    }
  })();
</script>
</body>
</html>
